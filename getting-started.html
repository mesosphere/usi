<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="USI - Unified Scheduler Interface">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="USI - Unified Scheduler Interface">
<link rel="shortcut icon" href="assets/images/favicon.png">
<title>Getting Started Â· Unified Scheduler Interface</title>
<link rel="stylesheet" href="assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="lib/prettify/prettify.css">
<script src="assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="assets/fonts/font-awesome.css">
<link rel="stylesheet" href="assets/fonts/material-icons.css">
<link rel="stylesheet" href="assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="index.html" title="Unified Scheduler Interface" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Unified Scheduler Interface
</span>
<span class="md-header-nav__topic">
Getting Started
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="index.html" title="Unified Scheduler Interface" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="index.html" title="Unified Scheduler Interface">
Unified Scheduler Interface
</a>
</label>
<ul>
  <li><a href="getting-started.html" class="active page">Getting Started</a></li>
  <li><a href="contributing/index.html" class="page">Contributors Guide</a>
  <ul>
    <li><a href="contributing/code-culture.html" class="page">Code Culture</a></li>
  </ul></li>
  <li><a href="design/index.html" class="page">Design</a></li>
  <li><a href="examples/index.html" class="page">Examples</a>
  <ul>
    <li><a href="examples/keep-alive-framework.html" class="page">Keep-Alive Example Framework</a></li>
  </ul></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="getting-started.html#getting-started" class="header">Getting Started</a>
  <ul>
    <li><a href="getting-started.html#project-setup" class="header">Project Setup</a></li>
    <li><a href="getting-started.html#hello-world" class="header">Hello World</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.45
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="getting-started.html#getting-started" class="header">Getting Started</a>
  <ul>
    <li><a href="getting-started.html#project-setup" class="header">Project Setup</a></li>
    <li><a href="getting-started.html#hello-world" class="header">Hello World</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#getting-started" name="getting-started" class="anchor"><span class="anchor-link"></span></a>Getting Started</h1>
<h2><a href="#project-setup" name="project-setup" class="anchor"><span class="anchor-link"></span></a>Project Setup</h2>
<p>Given you have added the <code>https://downloads.mesosphere.com/maven</code> Maven repository you can declare the following dependencies</p><dl class="dependency"><dt>sbt</dt><dd><pre class="prettyprint"><code class="language-scala">libraryDependencies ++= Seq(
  "com.mesosphere.usi" %% "core" % "0.1.45",
  "com.mesosphere.usi" %% "core-model" % "0.1.45",
  "com.mesosphere.usi" %% "mesos-client" % "0.1.45",
  "com.mesosphere.usi" %% "metrics-dropwizard" % "0.1.45"
)</code></pre></dd><dt>Maven</dt><dd><pre class="prettyprint"><code class="language-xml">&lt;dependency&gt;
  &lt;groupId&gt;com.mesosphere.usi&lt;/groupId&gt;
  &lt;artifactId&gt;core_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.1.45&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.mesosphere.usi&lt;/groupId&gt;
  &lt;artifactId&gt;core-model_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.1.45&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.mesosphere.usi&lt;/groupId&gt;
  &lt;artifactId&gt;mesos-client_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.1.45&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
  &lt;groupId&gt;com.mesosphere.usi&lt;/groupId&gt;
  &lt;artifactId&gt;metrics-dropwizard_2.12&lt;/artifactId&gt;
  &lt;version&gt;0.1.45&lt;/version&gt;
&lt;/dependency&gt;</code></pre></dd><dt>Gradle</dt><dd><pre class="prettyprint"><code class="language-gradle">dependencies {
  compile group: 'com.mesosphere.usi', name: 'core_2.12', version: '0.1.45',
  compile group: 'com.mesosphere.usi', name: 'core-model_2.12', version: '0.1.45',
  compile group: 'com.mesosphere.usi', name: 'mesos-client_2.12', version: '0.1.45',
  compile group: 'com.mesosphere.usi', name: 'metrics-dropwizard_2.12', version: '0.1.45'
}</code></pre></dd></dl>
<h2><a href="#hello-world" name="hello-world" class="anchor"><span class="anchor-link"></span></a>Hello World</h2>
<p>Let&rsquo;s start out with a simple <code>Hello World</code> program. We are going to connect to Mesos (1), start a task that echos <code>Hello World</code> (2) and then finish (3).</p>
<h3><a href="#1-connect-to-mesos" name="1-connect-to-mesos" class="anchor"><span class="anchor-link"></span></a>1 Connect to Mesos</h3>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/mesosphere/usi/tree/v0.1.45/examples/core-hello-world/src/main/scala/com/mesosphere/usi/examples/CoreHelloWorldFramework.scala#L130-L134" target="_blank" title="Go to snippet source"></a><code class="language-scala">val client: MesosClient = Await.result(MesosClient(clientSettings, frameworkInfo).runWith(Sink.head), 10.seconds)
val factory = SchedulerFactory(client, podRecordRepository, SchedulerSettings.load(), DummyMetrics)
val (snapshot, schedulerFlow) =
  Await.result(factory.newSchedulerFlow(), 10.seconds)
(client, snapshot, schedulerFlow)</code></pre>
<p>The <code>MesosClient(...)</code> factory method returns a future <code>MesosClient</code>. It requires the Mesos <a href="http://mesos.apache.org/api/latest/java/org/apache/mesos/Protos.FrameworkInfo.html">FrameworkInfo</a>. In this case we block until Mesos is connected. You should not do so in the real world. Also note, that we are not retrying the connection. See the section on <a href="#">Resilience</a>.</p>
<p>After the connection is established we create a USI scheduler flow. This is an <a href="https://doc.akka.io/docs/akka/current/stream/index.html">Akka Stream</a> flow that receives <a href="https://mesosphere.github.io/usi/api/latest/com/mesosphere/usi/core/models/commands/SchedulerCommand.html">SchedulerCommand</a>s and outputs <a href="https://mesosphere.github.io/usi/api/latest/com/mesosphere/usi/core/models/StateEvent.html">StateEvent</a>s. </p>
<h3><a href="#2-start-a-task" name="2-start-a-task" class="anchor"><span class="anchor-link"></span></a>2 Start a Task</h3>
<p>Once the client is connected and scheduler flow created we run a source via the flow.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/mesosphere/usi/tree/v0.1.45/examples/core-hello-world/src/main/scala/com/mesosphere/usi/examples/CoreHelloWorldFramework.scala#L152-L155" target="_blank" title="Go to snippet source"></a><code class="language-scala">val completed: Future[Done] = Source.maybe
  .prepend(Source.single(generateLaunchCommand))
  // Here our initial snapshot is going to the scheduler flow
  .via(schedulerFlow)</code></pre>
<p>The source is just a single <a href="https://mesosphere.github.io/usi/api/latest/com/mesosphere/usi/core/models/commands/LaunchPod.html">LaunchPod</a> command:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/mesosphere/usi/tree/v0.1.45/examples/core-hello-world/src/main/scala/com/mesosphere/usi/examples/CoreHelloWorldFramework.scala#L106-L118" target="_blank" title="Go to snippet source"></a><code class="language-scala">def generateLaunchCommand: LaunchPod = {
  // Lets construct the initial specs snapshot which will contain our hello-world PodSpec. For that we generate
  // - a unique PodId
  // - a RunSpec with minimal resource requirements and hello-world shell command
  // - a snapshot containing our PodSpec
  val podId = PodId(s&quot;hello-world.${UUID.randomUUID()}&quot;)
  val runSpec = SimpleRunTemplateFactory(
    resourceRequirements = List(ScalarRequirement.cpus(0.1), ScalarRequirement.memory(32)),
    shellCommand = &quot;&quot;&quot;echo &quot;Hello, world&quot; &amp;&amp; sleep 123456789&quot;&quot;&quot;,
    role = &quot;test&quot;
  )
  commands.LaunchPod(podId, runSpec = runSpec)
}</code></pre>
<p>We do not have to handle offer matching since USI is taking this work from our shoulder. We just care about what we want to launch.</p>
<h3><a href="#3-finish" name="3-finish" class="anchor"><span class="anchor-link"></span></a>3 Finish</h3>
<p>The last step handles the events emitted by USI.</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/mesosphere/usi/tree/v0.1.45/examples/core-hello-world/src/main/scala/com/mesosphere/usi/examples/CoreHelloWorldFramework.scala#L159-L174" target="_blank" title="Go to snippet source"></a><code class="language-scala">  // Main state event handler. We log happy events and exit if something goes wrong
  case PodStatusUpdatedEvent(id, Some(PodStatus(_, taskStatuses))) =&gt;
    import TaskState._
    def activeTask(status: TaskStatus) = Seq(TASK_STAGING, TASK_STARTING, TASK_RUNNING).contains(status.getState)

    // We&#39;re only interested in the happy task statuses for our pod
    val failedTasks = taskStatuses.filterNot { case (_, status) =&gt; activeTask(status) }
    assert(failedTasks.isEmpty, s&quot;Found failed tasks: $failedTasks, can&#39;t handle them now so will terminate&quot;)

    logger.info(s&quot;Task status updates for podId: $id: ${taskStatuses}&quot;)

  case e =&gt;
    logger.warn(s&quot;Unhandled event: $e&quot;) // we ignore everything else for now
}
.toMat(Sink.ignore)(Keep.right)
.run()</code></pre>
<p>In this simple case we just inform about the state of our task and finish. USI has launch at most once guarantees. That means it is upt to you the framework author to re-launch finished and failed tasks.</p>
</div>
<div>
<a href="https://github.com/mesosphere/usi/tree/v0.1.45/docs/src/paradox/getting-started.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.45
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="index.html" title="Unified Scheduler Interface" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Unified Scheduler Interface
</span>
</div>
</a>
<a href="contributing/index.html" title="Contributors Guide" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
Contributors Guide
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
</div>
</div>
</footer>

</div>
<script src="assets/javascripts/application.583bbe55.js"></script>
<script src="assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"."}})</script>
<script type="text/javascript" src="lib/prettify/prettify.js"></script>
<script type="text/javascript" src="lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
</body>
</html>
